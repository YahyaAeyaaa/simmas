generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              Int       @id @default(autoincrement())
  name            String
  email           String    @unique
  emailVerifiedAt DateTime? @map("email_verified_at")
  password        String
  role            Role
  avatar          String?
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  dudi            Dudi?
  guru            Guru?
  siswa           Siswa?
}

model Siswa {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique
  nama      String
  nis       String   @unique
  kelas     String
  jurusan   String
  alamat    String
  telepon   String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  magang    Magang[]
  user      User     @relation(fields: [userId], references: [id])
}

model Guru {
  id                  Int      @id @default(autoincrement())
  userId              Int      @unique
  nip                 String   @unique
  nama                String
  alamat              String
  telepon             String
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  dudiPenanggungJawab Dudi[]   @relation("DudiGuruPenanggungJawab")
  user                User     @relation(fields: [userId], references: [id])
  magang              Magang[]
}

model Dudi {
  id                    Int        @id @default(autoincrement())
  namaPerusahaan        String
  alamat                String
  telepon               String
  email                 String
  penanggungJawab       String
  status                DudiStatus
  createdAt             DateTime   @default(now()) @map("created_at")
  updatedAt             DateTime   @updatedAt @map("updated_at")
  userId                Int?       @unique
  bidangUsaha           String?    @map("bidang_usaha")
  deskripsi             String?
  kuotaMagang           Int?       @default(0) @map("kuota_magang")
  guruPenanggungJawabId Int?       @map("guru_penanggung_jawab_id")
  guruPenanggungJawab   Guru?      @relation("DudiGuruPenanggungJawab", fields: [guruPenanggungJawabId], references: [id])
  user                  User?      @relation(fields: [userId], references: [id])
  magang                Magang[]
}

model Magang {
  id             Int          @id @default(autoincrement())
  siswaId        Int
  dudiId         Int
  guruId         Int
  status         MagangStatus
  nilaiAkhir     Float?       @map("nilai_akhir")
  tanggalMulai   DateTime     @map("tanggal_mulai")
  tanggalSelesai DateTime     @map("tanggal_selesai")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  logbooks       Logbook[]
  dudi           Dudi         @relation(fields: [dudiId], references: [id])
  guru           Guru         @relation(fields: [guruId], references: [id])
  siswa          Siswa        @relation(fields: [siswaId], references: [id])
}

model Logbook {
  id               Int           @id @default(autoincrement())
  magangId         Int
  tanggal          DateTime
  kegiatan         String
  kendala          String
  file             String
  statusVerifikasi LogbookStatus @map("status_verifikasi")
  catatanGuru      String?
  createdAt        DateTime      @default(now()) @map("created_at")
  updatedAt        DateTime      @updatedAt @map("updated_at")
  catatanDudi      String?
  magang           Magang        @relation(fields: [magangId], references: [id])
}

model SchoolSettings {
  id            Int      @id @default(autoincrement())
  logoUrl       String?  @map("logo_url")
  namaSekolah   String?  @map("nama_sekolah")
  alamat        String?
  telepon       String?
  email         String?
  website       String?
  kepalaSekolah String?  @map("kepala_sekolah")
  npsn          String?  @unique
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
}

enum Role {
  admin
  siswa
  guru
}

enum DudiStatus {
  aktif
  nonaktif
  pending
}

enum MagangStatus {
  pending
  diterima
  ditolak
  berlangsung
  selesai
  dibatalkan
}

enum LogbookStatus {
  pending
  approved
  rejected
}
